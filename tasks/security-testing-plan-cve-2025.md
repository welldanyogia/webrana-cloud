# Security Testing Plan: Critical CVE Remediation

**Document ID:** QA-SEC-2025-001  
**Created:** 2025-12-06  
**Author:** Senior QA Engineer  
**Status:** ACTIVE  
**Priority:** P1 - Critical  

---

## Executive Summary

This document provides a comprehensive security testing plan for validating the remediation of 4 critical CVEs discovered in the Webrana Cloud platform. All identified vulnerabilities have CVSS scores ≥ 8.8 (High to Critical severity) and require immediate attention.

### CVE Summary Table

| CVE ID | Component | CVSS | Severity | Affected Package | Webrana Impact |
|--------|-----------|------|----------|------------------|----------------|
| CVE-2025-55182 | React | 10.0 | Critical | react@19.x | customer-web, admin-web |
| CVE-2025-49844 | Redis | 10.0 | Critical | redis:7-alpine | All backend services |
| CVE-2024-7348 | PostgreSQL | 8.8 | High | postgres:15-alpine | All services with Prisma |
| CVE-2024-53866 | pnpm | 9.8 | Critical | pnpm (build tool) | CI/CD pipeline |

---

## 1. Security Testing Checklist (Post-Patching Validation)

### 1.1 CVE-2025-55182 - React Remote Code Execution (CVSS 10.0)

**Vulnerability:** Remote Code Execution via malicious JSX props/server components  
**Affected Services:** `customer-web`, `admin-web`

#### Pre-Upgrade Checklist
- [ ] Document current React version: `react@19.x`
- [ ] Backup current `package.json` and `package-lock.json`
- [ ] Review React migration guide for breaking changes
- [ ] Identify all custom hooks and components using affected APIs

#### Post-Patch Validation Tests

```bash
# Run from project root
npx nx test customer-web --coverage
npx nx test admin-web --coverage
```

| Test ID | Test Case | Expected Result | Status |
|---------|-----------|-----------------|--------|
| SEC-REACT-001 | Verify React version upgraded | `npm list react` shows patched version | ⬜ |
| SEC-REACT-002 | XSS via user input in forms | Input sanitized, no script execution | ⬜ |
| SEC-REACT-003 | Malicious props injection | Props properly escaped | ⬜ |
| SEC-REACT-004 | dangerouslySetInnerHTML audit | All usages reviewed and safe | ⬜ |
| SEC-REACT-005 | Server component isolation | No client data leakage | ⬜ |
| SEC-REACT-006 | URL parameter injection | Router params sanitized | ⬜ |
| SEC-REACT-007 | localStorage/sessionStorage | No sensitive data exposed | ⬜ |
| SEC-REACT-008 | CSP headers validation | Content-Security-Policy enforced | ⬜ |

#### Security Test Script

```typescript
// test/security/react-cve-2025-55182.security.spec.ts
describe('CVE-2025-55182 React RCE Validation', () => {
  describe('XSS Prevention', () => {
    it('should sanitize user input in form fields', async () => {
      const maliciousInput = '<script>alert("xss")</script>';
      // Test input sanitization
    });

    it('should escape special characters in rendered output', async () => {
      const payload = '"><img src=x onerror=alert(1)>';
      // Verify proper escaping
    });
  });

  describe('Props Injection', () => {
    it('should reject malicious props patterns', async () => {
      // Test for CVE-specific attack vectors
    });
  });
});
```

---

### 1.2 CVE-2025-49844 - Redis Remote Code Execution (CVSS 10.0)

**Vulnerability:** Remote Code Execution via malformed RESP3 protocol commands  
**Affected Services:** All backend services using `ioredis`
- `auth-service` (rate limiting, session storage)
- `notification-service` (job queues)
- `order-service` (distributed locks)
- `api-gateway` (caching)

#### Pre-Upgrade Checklist
- [ ] Document current Redis Docker image: `redis:7-alpine`
- [ ] Document current ioredis version: check `package.json`
- [ ] Backup Redis data: `redis-cli BGSAVE`
- [ ] Review Redis AUTH configuration
- [ ] Ensure `REDIS_PASSWORD` is set in all environments

#### Post-Patch Validation Tests

```bash
# Verify Redis version
docker exec webrana-redis redis-server --version

# Test Redis connectivity after upgrade
docker exec webrana-redis redis-cli -a $REDIS_PASSWORD ping
```

| Test ID | Test Case | Expected Result | Status |
|---------|-----------|-----------------|--------|
| SEC-REDIS-001 | Verify Redis version upgraded | Docker image shows patched version | ⬜ |
| SEC-REDIS-002 | ioredis client version | `npm list ioredis` shows patched version | ⬜ |
| SEC-REDIS-003 | Redis AUTH enabled | Connection requires password | ⬜ |
| SEC-REDIS-004 | Rate limiting functional | 429 response after limit exceeded | ⬜ |
| SEC-REDIS-005 | Distributed lock works | Lock acquisition/release works | ⬜ |
| SEC-REDIS-006 | Notification queue works | Jobs enqueue and process | ⬜ |
| SEC-REDIS-007 | Network isolation | Redis not exposed publicly | ⬜ |
| SEC-REDIS-008 | Malformed command rejection | Invalid commands rejected gracefully | ⬜ |

#### Security Test Script

```typescript
// test/security/redis-cve-2025-49844.security.spec.ts
describe('CVE-2025-49844 Redis RCE Validation', () => {
  describe('Connection Security', () => {
    it('should reject unauthenticated connections', async () => {
      // Attempt connection without password
    });

    it('should handle malformed commands gracefully', async () => {
      // Send malformed RESP3 commands
    });
  });

  describe('Rate Limiting (auth-service)', () => {
    it('should enforce rate limits via Redis', async () => {
      // Execute rate-limit.security.spec.ts tests
    });
  });

  describe('Distributed Lock (order-service)', () => {
    it('should acquire and release locks correctly', async () => {
      // Test distributed-lock.service.ts
    });
  });
});
```

---

### 1.3 CVE-2024-7348 - PostgreSQL SQL Injection (CVSS 8.8)

**Vulnerability:** SQL Injection via pg_dump during concurrent index creation  
**Affected Services:** All services using PostgreSQL via Prisma
- `auth-service`
- `order-service`
- `billing-service`
- `catalog-service`
- `notification-service`

#### Pre-Upgrade Checklist
- [ ] Document current PostgreSQL version: `postgres:15-alpine`
- [ ] Document current Prisma version: `@prisma/client@6.19.0`
- [ ] Backup all databases: `pg_dumpall`
- [ ] Review database migration status
- [ ] Document all raw SQL queries (if any)

#### Post-Patch Validation Tests

```bash
# Verify PostgreSQL version
docker exec webrana-postgres psql -U webrana -c "SELECT version();"

# Run Prisma migrations
npm run db:migrate:deploy
```

| Test ID | Test Case | Expected Result | Status |
|---------|-----------|-----------------|--------|
| SEC-PG-001 | Verify PostgreSQL version | Docker shows patched version | ⬜ |
| SEC-PG-002 | Prisma client version | 6.19.0 or higher (patched) | ⬜ |
| SEC-PG-003 | SQL injection via order input | Input parameterized, no injection | ⬜ |
| SEC-PG-004 | SQL injection via search params | Parameters escaped | ⬜ |
| SEC-PG-005 | SQL injection via filter/sort | OrderBy/Where validated | ⬜ |
| SEC-PG-006 | Raw query audit | No vulnerable raw queries | ⬜ |
| SEC-PG-007 | Concurrent operations safe | No race conditions exploitable | ⬜ |
| SEC-PG-008 | Database backup integrity | pg_dump produces valid backup | ⬜ |

#### SQL Injection Test Payloads

```typescript
// test/security/postgresql-cve-2024-7348.security.spec.ts
const SQL_INJECTION_PAYLOADS = [
  "'; DROP TABLE orders; --",
  "1' OR '1'='1",
  "1; SELECT * FROM users WHERE '1'='1",
  "UNION SELECT NULL, username, password FROM users--",
  "'; WAITFOR DELAY '00:00:05'--",
  "${constructor.constructor('return this')()}",
  "{{7*7}}",
  "1' AND SLEEP(5)--",
];

describe('CVE-2024-7348 PostgreSQL SQL Injection', () => {
  describe('Prisma Parameterization', () => {
    SQL_INJECTION_PAYLOADS.forEach((payload) => {
      it(`should safely handle payload: ${payload.substring(0, 30)}...`, async () => {
        // Verify parameterization
      });
    });
  });
});
```

---

### 1.4 CVE-2024-53866 - pnpm Cache Poisoning (CVSS 9.8)

**Vulnerability:** Supply chain attack via corrupted cache during parallel installs  
**Affected Area:** CI/CD pipeline, local development

#### Pre-Upgrade Checklist
- [ ] Document current package manager: npm (not pnpm, but still assess)
- [ ] Review `package-lock.json` integrity
- [ ] Check GitHub Actions workflows for caching
- [ ] Audit any pnpm usage in scripts

#### Post-Patch Validation Tests

| Test ID | Test Case | Expected Result | Status |
|---------|-----------|-----------------|--------|
| SEC-PNPM-001 | Clean install verification | `npm ci` succeeds with integrity checks | ⬜ |
| SEC-PNPM-002 | Lock file integrity | package-lock.json SHA verified | ⬜ |
| SEC-PNPM-003 | CI/CD cache isolation | Each job has isolated cache | ⬜ |
| SEC-PNPM-004 | Dependency audit clean | `npm audit` shows no critical | ⬜ |
| SEC-PNPM-005 | Checksum verification | All package checksums match | ⬜ |
| SEC-PNPM-006 | No pnpm in codebase | Grep confirms no pnpm usage | ⬜ |

#### CI/CD Hardening Checklist

```yaml
# Recommended GitHub Actions security
- name: Verify package integrity
  run: |
    npm ci --ignore-scripts
    npm audit --audit-level=high
    
- name: Verify lockfile
  run: |
    npm ci --package-lock-only
    git diff --exit-code package-lock.json
```

---

## 2. Regression Test Plan (Post-Upgrade Validation)

### 2.1 Core Functionality Tests

After patching CVEs, ensure all critical business flows still work.

#### Backend Services Smoke Tests

```bash
# Run all service tests
npm run test

# Or run individually
npx nx test auth-service
npx nx test order-service
npx nx test billing-service
npx nx test catalog-service
npx nx test notification-service
npx nx test instance-service
npx nx test api-gateway
```

| Service | Critical Path | Test Command | Status |
|---------|---------------|--------------|--------|
| auth-service | User login/register | `npx nx test auth-service` | ⬜ |
| auth-service | JWT token validation | Integration test | ⬜ |
| order-service | Create order flow | `npx nx test order-service` | ⬜ |
| order-service | Provisioning task | E2E test | ⬜ |
| billing-service | Payment processing | `npx nx test billing-service` | ⬜ |
| catalog-service | Plan/Image listing | `npx nx test catalog-service` | ⬜ |
| notification-service | Email/queue processing | `npx nx test notification-service` | ⬜ |
| api-gateway | Request routing | `npx nx test api-gateway` | ⬜ |

#### Frontend Application Tests

```bash
# Run frontend tests
npx nx test customer-web
npx nx test admin-web

# Build verification
npx nx build customer-web
npx nx build admin-web
```

| Application | Critical Path | Test Type | Status |
|-------------|---------------|-----------|--------|
| customer-web | Homepage loads | Smoke | ⬜ |
| customer-web | User authentication | E2E | ⬜ |
| customer-web | Order creation flow | E2E | ⬜ |
| customer-web | Instance management | E2E | ⬜ |
| admin-web | Admin login | E2E | ⬜ |
| admin-web | Dashboard loads | Smoke | ⬜ |
| admin-web | User management | E2E | ⬜ |

### 2.2 Integration Tests

```bash
# Run integration tests (requires Docker)
docker-compose -f docker-compose.test.yml up -d
RUN_INTEGRATION_TESTS=true npx nx test order-service --testPathPattern=integration
```

| Integration | Components | Status |
|-------------|------------|--------|
| Auth ↔ Redis | Rate limiting, sessions | ⬜ |
| Order ↔ PostgreSQL | Order CRUD, transactions | ⬜ |
| Order ↔ Catalog | Plan/Image validation | ⬜ |
| Notification ↔ Redis | Job queue processing | ⬜ |
| API Gateway ↔ All Services | Request routing | ⬜ |

### 2.3 Existing Security Test Suite

Ensure all existing security tests pass after patching:

```bash
# Run existing security tests
cd test/security
npx jest --config jest.config.ts
```

| Test File | Coverage Area | Status |
|-----------|---------------|--------|
| api-security.security.spec.ts | API security controls | ⬜ |
| authentication.security.spec.ts | Auth mechanisms | ⬜ |
| authorization.security.spec.ts | RBAC/permissions | ⬜ |
| input-validation.security.spec.ts | Input sanitization | ⬜ |
| rate-limit.security.spec.ts | Rate limiting | ⬜ |
| security-headers.security.spec.ts | HTTP headers | ⬜ |

### 2.4 Performance Baseline Verification

Ensure upgrades don't degrade performance:

| Metric | Baseline | Post-Patch | Threshold | Status |
|--------|----------|------------|-----------|--------|
| API Gateway p95 latency | <100ms | TBD | <150ms | ⬜ |
| Order creation time | <500ms | TBD | <750ms | ⬜ |
| Redis operation latency | <5ms | TBD | <10ms | ⬜ |
| DB query p95 | <50ms | TBD | <75ms | ⬜ |

---

## 3. Security Scanning Tools Recommendations

### 3.1 Dependency Scanning (Immediate - Run Daily)

#### npm audit (Built-in)

```bash
# Check for vulnerabilities
npm audit

# Auto-fix where possible
npm audit fix

# Generate JSON report
npm audit --json > reports/npm-audit-$(date +%Y%m%d).json

# Fail CI on high/critical
npm audit --audit-level=high
```

**Pros:** Built-in, no setup required  
**Cons:** Limited to npm registry data  
**Recommendation:** ✅ Use as primary first-line scanner

#### Snyk (Recommended for Deep Analysis)

```bash
# Install Snyk CLI
npm install -g snyk

# Authenticate
snyk auth

# Test project
snyk test

# Monitor continuously
snyk monitor

# Test Docker images
snyk container test postgres:15-alpine
snyk container test redis:7-alpine

# Generate HTML report
snyk test --json | snyk-to-html -o reports/snyk-report.html
```

**Pros:** Deep analysis, container scanning, license compliance  
**Cons:** Requires account, some features paid  
**Recommendation:** ✅ Use for comprehensive vulnerability database

### 3.2 Container Image Scanning

#### Trivy (Recommended for Containers)

```bash
# Install Trivy (Docker)
docker pull aquasec/trivy:latest

# Scan Docker images
trivy image postgres:15-alpine
trivy image redis:7-alpine
trivy image node:20-alpine

# Scan with severity filter
trivy image --severity HIGH,CRITICAL postgres:15-alpine

# Generate JSON report
trivy image --format json -o reports/trivy-postgres.json postgres:15-alpine

# Scan filesystem (for local code)
trivy fs --security-checks vuln,config .

# Scan IaC (docker-compose, k8s)
trivy config docker/
```

**Pros:** Free, fast, comprehensive database, IaC scanning  
**Cons:** Requires Docker  
**Recommendation:** ✅ Use for all container images

### 3.3 Static Application Security Testing (SAST)

#### Semgrep (Recommended for Code)

```bash
# Install Semgrep
pip install semgrep

# Run with security rules
semgrep --config=p/security-audit .

# TypeScript/JavaScript specific
semgrep --config=p/typescript .
semgrep --config=p/javascript .

# OWASP rules
semgrep --config=p/owasp-top-ten .

# Generate SARIF report
semgrep --config=p/security-audit --sarif -o reports/semgrep.sarif .
```

**Pros:** Fast, accurate, customizable rules  
**Cons:** May require tuning for false positives  
**Recommendation:** ✅ Integrate into CI/CD

### 3.4 Dynamic Application Security Testing (DAST)

#### OWASP ZAP (For API Testing)

```bash
# Run ZAP in Docker
docker run -t owasp/zap2docker-stable zap-api-scan.py \
  -t http://localhost:4000/api/v1/swagger.json \
  -f openapi \
  -r reports/zap-api-report.html
```

**Pros:** Comprehensive API testing, OWASP maintained  
**Cons:** Requires running application  
**Recommendation:** ⚠️ Use for pre-release security testing

### 3.5 Secret Scanning

#### TruffleHog (For Git History)

```bash
# Install TruffleHog
pip install trufflehog

# Scan git history
trufflehog git file://. --only-verified

# Scan filesystem
trufflehog filesystem . --only-verified
```

**Pros:** Finds secrets in git history  
**Cons:** Can be slow on large repos  
**Recommendation:** ✅ Run before any release

### 3.6 Recommended Tool Stack Summary

| Layer | Tool | Purpose | Priority | Cost |
|-------|------|---------|----------|------|
| Dependencies | npm audit | First-line scanning | P1 | Free |
| Dependencies | Snyk | Deep vulnerability analysis | P1 | Freemium |
| Containers | Trivy | Image vulnerability scanning | P1 | Free |
| Code | Semgrep | Static code analysis | P2 | Freemium |
| API | OWASP ZAP | Dynamic API testing | P3 | Free |
| Secrets | TruffleHog | Secret detection | P2 | Free |
| IaC | Trivy | Docker/K8s config | P2 | Free |

### 3.7 CI/CD Integration Script

```yaml
# .github/workflows/security-scan.yml
name: Security Scan

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]
  schedule:
    - cron: '0 6 * * *'  # Daily at 6 AM

jobs:
  dependency-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: Install dependencies
        run: npm ci --ignore-scripts
        
      - name: npm audit
        run: npm audit --audit-level=high
        
      - name: Snyk scan
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high

  container-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run Trivy - PostgreSQL
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'postgres:15-alpine'
          severity: 'CRITICAL,HIGH'
          
      - name: Run Trivy - Redis
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'redis:7-alpine'
          severity: 'CRITICAL,HIGH'

  sast-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Semgrep scan
        uses: returntocorp/semgrep-action@v1
        with:
          config: >-
            p/security-audit
            p/typescript
            p/owasp-top-ten

  secret-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
          
      - name: TruffleHog scan
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          extra_args: --only-verified
```

---

## 4. Security Audit Timeline

### Phase 1: Immediate Response (Day 1-2)

| Day | Task | Owner | Deliverable |
|-----|------|-------|-------------|
| D1 AM | Run npm audit, document current state | QA | Audit report |
| D1 AM | Run Trivy on all containers | QA | Container scan report |
| D1 PM | Create backup of all databases | DevOps | Backup verification |
| D1 PM | Create backup of current codebase | DevOps | Git tag `pre-cve-patch` |
| D2 AM | Prepare test environment | QA | Staging ready |
| D2 PM | Document rollback procedure | DevOps | Rollback playbook |

### Phase 2: Patching (Day 3-5)

| Day | Task | Owner | Deliverable |
|-----|------|-------|-------------|
| D3 | Upgrade React to patched version | Frontend | Updated package.json |
| D3 | Run frontend unit tests | QA | Test results |
| D4 | Upgrade Redis Docker image | DevOps | Updated docker-compose |
| D4 | Upgrade ioredis client | Backend | Updated package.json |
| D4 | Run Redis-related tests | QA | Test results |
| D5 | Upgrade PostgreSQL Docker image | DevOps | Updated docker-compose |
| D5 | Run database migration tests | QA | Migration results |
| D5 | Run all unit tests | QA | Full test report |

### Phase 3: Security Validation (Day 6-7)

| Day | Task | Owner | Deliverable |
|-----|------|-------|-------------|
| D6 AM | Execute security test checklist | QA | Checklist completion |
| D6 PM | Run CVE-specific security tests | QA | Security test report |
| D7 AM | Run full regression test suite | QA | Regression report |
| D7 PM | Performance baseline comparison | QA | Performance report |

### Phase 4: Staging Deployment (Day 8-9)

| Day | Task | Owner | Deliverable |
|-----|------|-------|-------------|
| D8 AM | Deploy to staging environment | DevOps | Staging deployment |
| D8 PM | Execute E2E tests on staging | QA | E2E test results |
| D9 AM | Security scan on staging | QA | Final scan report |
| D9 PM | UAT sign-off | PM/QA | UAT approval |

### Phase 5: Production Deployment (Day 10)

| Day | Task | Owner | Deliverable |
|-----|------|-------|-------------|
| D10 AM | Production deployment (blue-green) | DevOps | Deployment complete |
| D10 AM | Smoke tests on production | QA | Smoke test results |
| D10 PM | Monitor for 4 hours | DevOps/QA | Monitoring report |
| D10 PM | Declare CVE remediation complete | PM | Closure report |

### Timeline Summary

```
Week 1:
├── Day 1-2: Preparation & Backup
├── Day 3-5: Patching & Unit Testing
└── Day 6-7: Security Validation

Week 2:
├── Day 8-9: Staging Deployment & UAT
└── Day 10: Production Deployment
```

**Total Duration:** 10 working days  
**Critical Path:** Redis/PostgreSQL upgrades (potential data migration)

---

## 5. Quality Gates

### Gate 1: Pre-Deployment to Staging

- [ ] All CVE patches applied
- [ ] All unit tests pass (100%)
- [ ] Security checklist complete (100%)
- [ ] npm audit shows no critical/high vulnerabilities
- [ ] Trivy shows no critical container vulnerabilities

### Gate 2: Pre-Deployment to Production

- [ ] All E2E tests pass on staging
- [ ] Performance within 25% of baseline
- [ ] Security scan clean (Snyk, Trivy)
- [ ] Rollback procedure tested
- [ ] UAT sign-off obtained

### Gate 3: Post-Production Deployment

- [ ] Smoke tests pass
- [ ] No increase in error rates
- [ ] No performance degradation
- [ ] Security monitoring enabled
- [ ] Incident response ready

---

## 6. Rollback Procedure

### If Issues Found Post-Patch

```bash
# 1. Revert to pre-patch git tag
git checkout pre-cve-patch
npm ci

# 2. Restore database from backup (if schema changed)
pg_restore -U webrana -d webrana backup-pre-cve.sql

# 3. Redeploy previous Docker images
docker-compose -f docker-compose.yml down
docker-compose -f docker-compose.yml.bak up -d

# 4. Verify services healthy
./scripts/health-check.sh
```

---

## 7. Appendices

### A. Test Data Requirements

| Test Category | Data Needed | Source |
|---------------|-------------|--------|
| Auth tests | Test user accounts | Seed script |
| Order tests | Sample orders | Fixtures |
| Redis tests | Rate limit counters | Generated |
| SQL injection | Payloads | Security corpus |

### B. Environment Requirements

| Environment | Purpose | Database | Redis |
|-------------|---------|----------|-------|
| Local | Development | Testcontainers | Testcontainers |
| CI | Automated tests | Testcontainers | Testcontainers |
| Staging | UAT | Isolated DB | Isolated Redis |
| Production | Live | Prod DB | Prod Redis |

### C. Contact List

| Role | Responsibility |
|------|----------------|
| QA Lead | Test execution, reporting |
| Backend Lead | Service patching |
| Frontend Lead | React upgrade |
| DevOps Lead | Infrastructure, deployment |
| Security Lead | Final approval |

---

## 8. Sign-Off

| Role | Name | Date | Signature |
|------|------|------|-----------|
| QA Engineer | | | |
| Security Lead | | | |
| Engineering Lead | | | |
| Product Manager | | | |

---

**Document Version:** 1.0  
**Last Updated:** 2025-12-06  
**Next Review:** After CVE remediation complete
